import streamlit as st
import graphviz
import pandas as pd
import numpy as np
import plotly.express as px

# --- ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö ---
st.set_page_config(page_title="‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß", page_icon="üåç", layout="wide")

# --- ‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢ ---
st.sidebar.title("‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å")
menu_choice = st.sidebar.selectbox(
    "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£:",
    ("Dashboard ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•", "‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î", "‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à")
)

# ------------------------------
# 1. Dashboard
# ------------------------------
if menu_choice == "Dashboard ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•":
    st.title("üìä Dashboard ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•")
    st.write("‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß 200 ‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö")

    # --- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á ---
    @st.cache_data
    def create_mock_data():
        num_tourists = 200
        provinces = ["‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï", "‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà", "‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø", "‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ", "‡∏Å‡∏£‡∏∞‡∏ö‡∏µ‡πà"]
        types = ["‡∏ó‡∏∞‡πÄ‡∏•", "‡∏†‡∏π‡πÄ‡∏Ç‡∏≤", "‡∏ß‡∏±‡∏í‡∏ô‡∏ò‡∏£‡∏£‡∏°", "‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°"]
        data = {
            '‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î': np.random.choice(provinces, num_tourists, p=[0.25, 0.25, 0.2, 0.15, 0.15]),
            '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà': np.random.choice(types, num_tourists)
        }
        df = pd.DataFrame(data)
        return df

    df = create_mock_data()

    # --- ‡∏Å‡∏£‡∏≤‡∏ü‡∏™‡∏£‡∏∏‡∏õ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î ---
    st.header("‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î")
    province_counts = df['‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î'].value_counts().reset_index()
    province_counts.columns = ['‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î', '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏±‡∏Å‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß']

    fig_bar = px.bar(province_counts, 
                     x='‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î', 
                     y='‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏±‡∏Å‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß',
                     title="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î",
                     color='‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î',
                     text_auto=True)
    st.plotly_chart(fig_bar, use_container_width=True)

    # --- ‡∏Å‡∏£‡∏≤‡∏ü‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà ---
    st.header("‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡∏ó‡∏µ‡πà‡∏ô‡∏¥‡∏¢‡∏°")
    fig_pie = px.pie(df, names='‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà', title='‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà')
    st.plotly_chart(fig_pie, use_container_width=True)

    st.header("‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏¥‡∏ö")
    st.dataframe(df)


# ------------------------------
# 2. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î
# ------------------------------
elif menu_choice == "‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î":
    st.title("üìö ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß")
    st.write("‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡∏Å‡∏±‡∏ö‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°‡∏Ç‡∏≠‡∏á‡πÑ‡∏ó‡∏¢")

    st.header("üå¥ ‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï")
    st.write("- ‡∏´‡∏≤‡∏î‡∏õ‡πà‡∏≤‡∏ï‡∏≠‡∏á, ‡∏´‡∏≤‡∏î‡∏Å‡∏∞‡∏ï‡∏∞, ‡πÄ‡∏Å‡∏≤‡∏∞‡∏û‡∏µ‡∏û‡∏µ (‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: ‡∏ó‡∏∞‡πÄ‡∏•)")

    st.header("‚õ∞Ô∏è ‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà")
    st.write("- ‡∏î‡∏≠‡∏¢‡∏™‡∏∏‡πÄ‡∏ó‡∏û, ‡∏î‡∏≠‡∏¢‡∏≠‡∏¥‡∏ô‡∏ó‡∏ô‡∏ô‡∏ó‡πå, ‡∏ñ‡∏ô‡∏ô‡∏ô‡∏¥‡∏°‡∏°‡∏≤‡∏ô (‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: ‡∏†‡∏π‡πÄ‡∏Ç‡∏≤ + ‡∏ß‡∏±‡∏í‡∏ô‡∏ò‡∏£‡∏£‡∏°)")

    st.header("üèôÔ∏è ‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø")
    st.write("- ‡∏ß‡∏±‡∏î‡∏û‡∏£‡∏∞‡πÅ‡∏Å‡πâ‡∏ß, ‡∏û‡∏£‡∏∞‡∏ö‡∏£‡∏°‡∏°‡∏´‡∏≤‡∏£‡∏≤‡∏ä‡∏ß‡∏±‡∏á, ‡∏ñ‡∏ô‡∏ô‡∏Ç‡πâ‡∏≤‡∏ß‡∏™‡∏≤‡∏£ (‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: ‡∏ß‡∏±‡∏í‡∏ô‡∏ò‡∏£‡∏£‡∏° + ‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°)")

    st.header("üåä ‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ")
    st.write("- ‡∏û‡∏±‡∏ó‡∏¢‡∏≤, ‡πÄ‡∏Å‡∏≤‡∏∞‡∏•‡πâ‡∏≤‡∏ô, ‡∏™‡∏ß‡∏ô‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏Ç‡∏≤‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß (‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: ‡∏ó‡∏∞‡πÄ‡∏• + ‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°)")

    st.header("üèñÔ∏è ‡∏Å‡∏£‡∏∞‡∏ö‡∏µ‡πà")
    st.write("- ‡∏≠‡πà‡∏≤‡∏ß‡∏ô‡∏≤‡∏á, ‡∏ó‡∏∞‡πÄ‡∏•‡πÅ‡∏´‡∏ß‡∏Å, ‡πÄ‡∏Å‡∏≤‡∏∞‡∏û‡∏µ‡∏û‡∏µ (‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: ‡∏ó‡∏∞‡πÄ‡∏•)")


# ------------------------------
# 3. ‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à
# ------------------------------
elif menu_choice == "‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à":
    st.title("üìù ‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß")
    st.write("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥")

    st.sidebar.header("‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà")
    budget = st.sidebar.radio("1. ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì", ["‡∏ï‡πà‡∏≥ (<5000)", "‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á (5000-15000)", "‡∏™‡∏π‡∏á (>15000)"], key="budget")
    prefer = st.sidebar.radio("2. ‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏≠‡∏ö‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏Å‡∏≤‡∏®‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô", ["‡∏ó‡∏∞‡πÄ‡∏•", "‡∏†‡∏π‡πÄ‡∏Ç‡∏≤", "‡∏ß‡∏±‡∏í‡∏ô‡∏ò‡∏£‡∏£‡∏°", "‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°"], key="prefer")
    season = st.sidebar.radio("3. ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á", ["‡∏´‡∏ô‡πâ‡∏≤‡∏£‡πâ‡∏≠‡∏ô", "‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏ô‡∏≤‡∏ß", "‡∏´‡∏ô‡πâ‡∏≤‡∏ù‡∏ô"], key="season")

    if st.sidebar.button("‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥"):
        result_province = ""
        result_spot = ""
        result_type = prefer

        # Logic ‡∏Å‡∏≤‡∏£‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô
        if prefer == "‡∏ó‡∏∞‡πÄ‡∏•":
            if budget == "‡∏ï‡πà‡∏≥ (<5000)":
                result_province, result_spot = "‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ", "‡πÄ‡∏Å‡∏≤‡∏∞‡∏•‡πâ‡∏≤‡∏ô"
            else:
                result_province, result_spot = "‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï", "‡∏´‡∏≤‡∏î‡∏õ‡πà‡∏≤‡∏ï‡∏≠‡∏á"
        elif prefer == "‡∏†‡∏π‡πÄ‡∏Ç‡∏≤":
            result_province, result_spot = "‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà", "‡∏î‡∏≠‡∏¢‡∏≠‡∏¥‡∏ô‡∏ó‡∏ô‡∏ô‡∏ó‡πå"
        elif prefer == "‡∏ß‡∏±‡∏í‡∏ô‡∏ò‡∏£‡∏£‡∏°":
            result_province, result_spot = "‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø", "‡∏ß‡∏±‡∏î‡∏û‡∏£‡∏∞‡πÅ‡∏Å‡πâ‡∏ß"
        else: # ‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°
            result_province, result_spot = "‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø", "‡∏ñ‡∏ô‡∏ô‡∏Ç‡πâ‡∏≤‡∏ß‡∏™‡∏≤‡∏£"

        # ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
        st.success(f"‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠: **{result_province}**")
        st.info(f"‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°: {result_spot} ({result_type})")

        # ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à
        dot = graphviz.Digraph()
        dot.node("A", "‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì")
        dot.node("B", "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏≠‡∏ö")
        dot.node("C", "‡∏§‡∏î‡∏π‡∏Å‡∏≤‡∏•")
        dot.node("D", f"‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå: {result_province} - {result_spot} ({result_type})")
        dot.edges(["AB", "BC", "CD"])
        st.graphviz_chart(dot)
    else:
        st.info("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° '‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥'")
